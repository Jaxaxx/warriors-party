# redis 

### redis 支持以下几种数据类型: 
    字符串 --> String 
    链表 --> 
    集合 -->
    有序集合 -->
    支持在服务器端计算集合的并集,交集和补集(difference)等，
    还支持多种排序功能。所以Redis也可以被看成是一个数据结构服务器。

### 数据可持久化---RDB AOF

#### RDB 的优劣势:
    
    * RDB属于redis默认的持久化机制: 是指在指定的时间间隔内将内存中的数据集快照写入磁盘
    这种方式是就是将内存中数据以快照的方式写入到二进制文件中,默认的文件名为dump.rdb
    可以通过配置设置自动做快照持久化的方式。我们可以配置redis在n秒内如果超过m个key被修改就自动做快照，下面是默认的快照保存配置
       save 900 1       #900秒内如果超过1个key被修改，则发起快照保存
       save 300 10      ********#300秒内容如超过10个key被修改，则发起快照保存
       save 60 10000
      
    RDB 文件保存过程:
        redis 调用fork,派生出子进程(fork就是分支或者创建子进程的意思),现在就有了子进程和父进程
    父进程继续处理client的请求,子进程负责将内存内容写入到临时文件,由于OS的写时复制(copy on write)机制,父子进程会共享
    相同的物理页面,当父进程处理写请求是OS会为父进程要修改的页面创建副本,而不是写共享的页面,所以子进程的地址空间内的数据是
    fork时刻整合数据库的快照.
        当子进程将快照写进临时文件完毕后,用临时文件替换原来的快照文件,然奇子进程退出.
    client 也可以使用save或者bgsave命令通知redis做一次快照的持久化,save操作是在主线程中保存快照的,由于redsi是用一个
    主线程来处理所有的client请求,所以这种方式会阻塞所有的client请求,不推荐使用.
        另外的胡,RDB的快照持久化都是将内存数据完整写入磁盘一次,全量操作,并不是增量的只同步脏数据,如果数据量大的话,再加上
    写操作比较多,必然会引起大量的磁盘IO操作,可能严重影响性能.
    
#####RDB优势

    1.采用RDB方式,整合redis数据库只包含一个文件,方便备份.可以很容易的将一个个的RDB文件移动到其他的存储介质上    
    2.RDB在恢复大数据集是速度要比AOF恢复速度快
    3.RDB可以最大化redis的性能: 父进程在保存RDB文件时唯一要做的就是fork出一个子进程,然后这个子进程就会处理接下来的所有
    保存工作,父进程无需执行任何磁盘IO操作
    
#####RDB劣势
    
    1.虽然RDB允许设置不同的保存点(save point) 来控制保存RDB文件的频率,但是因为RDB文件需要保存整合数据集的状态这个操作
    并不轻松,如果在这个情况下,服务器发生故障,那么久会丢失一个时间点的数据
    2.每次保存RDB的时候,redis都要fork出一个子进程,数据集庞大的话fork就比较耗时,造成服务器会在某某某毫秒内停止处理客户端
    加上CPU紧张的话,可能造成不必要的问题....虽然AOF重写也需要进行fork,但是AOF重写的执行间隔有多长,数据的耐久性都不会有
    任何的损失.
    
#### AOF

    redis 会将每一个收到的写命令都通过writer函数追加到appendonly.aof中.
    当redis充值期会通过重新自行文件中保存的写命令在内存中重建整合数据库的内容,当然由于os会在内核中缓存writer做修改,
    所以可能不是立即写在磁盘上,这样aof的持久化还是有可能会造成部分丢失,不过我们可以通过配置文件告诉redis我们要通过fsync
    函数强制os写入磁盘的时机,如下:
        appendonly yes // 启动aof持久化方式
        # appendfsync always      //每次收到写命令就立即强制写入磁盘，最慢的，但是保证完全的持久化，不推荐使用
        appendfsync everysec     //每秒钟强制写入磁盘一次，在性能和持久化方面做了很好的折中，推荐
        # appendfsync no    //完全依赖os，性能最好,持久化没保证
        
        
        
        
        
        
        
        
        
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       